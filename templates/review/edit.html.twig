{% extends 'base.html.twig' %}
{% from 'theme/macro.html.twig' import backlink, form_modal, form_buttons %}

{% set isEditMode = review.id is not null %}
{% set title = isEditMode ? 'review.edit.title.update'|trans({ '{name}': review.game.name }) : 'review.edit.title.add'|trans %}

{% block main %}
  {# Modal to confirm delete, if in EDIT mode #}
  {% if isEditMode %}
    {{ form_modal('review.edit.modalDeleteBody'|trans({ '{name}': review.game.name }), path('review_delete', { id: review.id })) }}
  {% endif %}

  {# Actual content with flashes and form #}
  <section>
    <div class="container">
      <div class="row">
        <div class="col-12 col-md-10 offset-md-1 col-lg-8 offset-lg-2">
          {# Insert the flashes in the same col size as the form #}
          {{ block('flash', 'theme/flash.html.twig') }}

          {# Back link #}
          {{ backlink(path('review_index')) }}

          {# Form start #}
          {{ form_start(form) }}

          {# Select the game for a new review #}
          {% if form.game is defined %}
            {{ form_row(form.game, { label: 'review.label.game' }) }}
          {% endif %}

          {# Display the rating range cursor with custom stimulus controller to display the value #}
          <div class="app-form-row" {{ stimulus_controller('rating-slide', { lazy: false }) }}>
            {{ form_label(form.rating, 'review.label.rating') }}
            {# {{ form_help(form.rating, { help_html: true, help: 'review.help.rating' }) }} #}
            <div class="form-control py-2 d-flex align-items-center">
              <div class="flex-grow-1 mt-1 app-form-range-tick" style="--step:1; --min:0; --max:6">
                {{ form_widget(form.rating, { attr: { 'data-rating-slide-target': 'range' } }) }}
              </div>
              <div class="app-rating-display text-end px-2">
                <span data-rating-slide-target="display" class="fs-5 align-middle">{{ '3.0'|format_number({ fraction_digit: 1 }) }}</span>
                <span class="fa-solid fa-star align-middle" aria-hidden="true"></span>
              </div>
            </div>
            <datalist id="rating-list" data-rating-slide-target="datalist">
              {% for rating in range(0, 6, 0.1) %}
                <option value="{{ rating }}" label="{{ rating|format_number({ fraction_digit: 1 }) }}" />
              {% endfor %}
            </datalist>
            {{ form_errors(form.rating) }}
          </div>

          {# Others fields : hour spend, first play, and comment #}
          <div class="row">
            <div class="col-12 col-md-6">
              {{ form_row(form.hourSpend, { label: 'review.label.hourSpend' }) }}
            </div>
            <div class="col-12 col-md-6">
              {{ form_row(form.firstPlay, { label: 'review.label.firstPlay' }) }}
            </div>
          </div>
          {{ form_row(form.comment, { label: 'review.label.comment' }) }}

          {# Buttons to submit, or open the delete modal #}
          {{ form_buttons(form, isEditMode) }}
          {{ form_rest(form) }}
          {{ form_end(form) }}
        </div>
      </div>
    </div>
  </section>
{% endblock %}
